{% load static %}
{% load compress %}

<ul class="tabs">
    <li class="finished">
        <div>1</div>
        <span class="skewed-rectangle"></span>
    </li>
    <li class="finished">
        <div>2</div>
        <span class="skewed-rectangle"></span>
    </li>
    <li class="active">
        <div>3</div>
        <span class="skewed-rectangle"></span>
    </li>
</ul>
<div class="illustrations">
    <div class="wrapper">
        <img eager src="{% static 'svg/circumference.svg' %}">
    </div>
</div>
<form class="controls">
    {% csrf_token %}
    <!-- <label>My foot length</label> -->
    <div class="wrapper">
        <img 
            src="{% static 'svg/btn_previous.svg' %}" 
            oninput="javascript: if (this.value.length > 4) this.value = this.value.slice(0, 4);"
            hx-get="{% url 'shoe_finder' step='width' %}"
            hx-push-url="true"
            hx-trigger="click"
            hx-target=".shoe-finder"
        />
        <div class="value input">
            <div 
                class="input-wrapper"
                x-data="{ 
                    inputValue: parseFloat({{ input_value }}).toFixed(1) 
                }"
            >
                <label>My foot circumference</label>   
                <input
                    name="{{ step }}"
                    x-model="inputValue"
                    type="number"
                    type="text"
                    step="0.1"
                    autofocus
                    min="0"
                    @keydown.enter="$refs.next.click()"
                    x-init="$watch('inputValue', (value) => {
                        if (value < 0) value = 0.0;
                        if (value.length > 4) value = value.slice(0, 4);
                        if (value < 1) {
                            value = String(value).slice(value.length - 1, value.length);
                        }
                        if (value > 99 && value.length < 4) {
                            value = parseFloat(
                                String(value).slice(0, 2) + '.' + String(value).slice(2, 3)
                            );
                        } else if (value > 99) {
                            value = parseFloat(
                                String(value).slice(1, 3) + '.' + String(value).slice(3, 4)
                            );
                        } else if (value < 99 && value.length < 4) {
                            if (String(value).slice(0, 1) == 0) {
                                value = parseFloat(String(value).slice(1, value.length));
                            }
                        } else if (value < 10 && value.length > 3) {
                            value = parseFloat(
                                String(value).slice(0, 3)
                            );
                        }
                        inputValue = value;
                    })"
                />
                <span class="cm">cm</span>
            </div>
        </div>
        <img 
            src="{% static 'svg/btn_next.svg' %}" 
            hx-post="{% url 'summary' %}"
            hx-include="input[name=circumference]"
            hx-push-url="true"
            hx-trigger="click"
            hx-target=".shoe-finder"
            hx-swap="innerHTML"
        />
    </div>
</form>
<ul class="messages">
    {% for message in messages %}
    {% if message.tags == 'shoe_finder error' %}
    <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
    {% endif %}
    {% endfor %}
</ul>
<div class="info">
    <h3>
        Determining your instep circumference:
    </h3>
    <p>
        If you don't have a tape measure at hand, you can also use a string to measure the circumference. Then place it on a ruler or tape measure to read off the cm.
    </p>
    <p>
        Again, please miss the right and the left foot. If the result is different, write down the larger value in cm.
    </p>
</div>